<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css" />
    <title>Generate Images</title>
  </head>

  <body>
    <h1>Generate Images</h1>

    <form id="generateImagesForm">
      <div>
        <label for="clothName">Cloth Name:</label>
        <input type="text" id="clothName" name="clothName" required>
      </div>

      <div>
        <label for="imageName">Image Name:</label>
        <input type="text" id="imageName" name="imageName" required>
      </div>

      <button type="button" onclick="generateImages()">Generate Images</button>
    </form>

    <div class="container">
      <div id="result"></div>
    </div>

    <script>
    const server_base_url = "http:/localhost:8000"

    const getInference = async (payload) => {
      const options = {
        method: "POST",
        headers: {
          "accept": "application/json",
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      }

      try {
        const p = await fetch(`${server_base_url}/viton/infer`, options)
        const response = await p.json()
        return response
      }
      
      catch (error) {
        console.log("(get_inference) Error: ", error)
      }
    }

    const generateImages = async () => {
      const clothName = document.getElementById("clothName").value;
      const imageName = document.getElementById("imageName").value;

      const payload = {
        "cloth_name": clothName,
        "img_name": imageName
      }

      try {
        data = await getInference(payload)
        displayResult(data)
      }

      catch (error) {
        console.log("(generateImages) Error: ", error)
      }
    }

    function displayResult(data) {
      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML = "";

      for (const [key, value] of Object.entries(data)) {
        const div = document.createElement("div");
        const h4 = document.createElement("h4");
        const img = document.createElement("img");

        h4.textContent = key;
        img.src = `${server_base_url}${value}`;

        div.appendChild(h4);
        div.appendChild(img);

        resultDiv.appendChild(div);
      }
    }
    </script>

  </body>
</html>

